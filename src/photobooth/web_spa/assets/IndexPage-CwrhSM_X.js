import{j as R,k as z,l as D,m as G,d as $,n as Q,p as S,o as j,q as W,s as T,v as E,t as g,i as a,x as c,g as f,w as y,y as V,z as B,F as q,A as K,f as w,B as l,C as i,D as L,Q as N,E as U,G as x,H as O,I as X,e as J,J as Y,u as Z,a as ee,K as te,c as ie,_ as F,r as H}from"./index-BzVvpN4o.js";import{Q as I}from"./QPageSticky-BhN0Watw.js";import{Q as ne}from"./QPage-D5F7xgSS.js";import{Q as ae}from"./QCircularProgress-R-BmdVAH.js";import{_ as oe}from"./RouteAfterTimeout.vue_vue_type_script_setup_true_lang-C7TYYDKx.js";import"./format-CJebrXOQ.js";const re='<circle cx="12.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="0s" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="52.5" r="12.5" fill-opacity=".5"><animate attributeName="fill-opacity" begin="100ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="300ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="600ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="800ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="400ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="700ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="500ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="200ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',se=R({name:"QSpinnerGrid",props:z,setup(p){const{cSize:n,classes:e}=D(p);return()=>G("svg",{class:e.value,fill:"currentColor",width:n.value,height:n.value,viewBox:"0 0 105 105",xmlns:"http://www.w3.org/2000/svg",innerHTML:re})}}),le='<g fill="none" fill-rule="evenodd" stroke-width="2"><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="0s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="0s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="-0.9s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="-0.9s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle></g>',ce=R({name:"QSpinnerPuff",props:z,setup(p){const{cSize:n,classes:e}=D(p);return()=>G("svg",{class:e.value,stroke:"currentColor",width:n.value,height:n.value,viewBox:"0 0 44 44",xmlns:"http://www.w3.org/2000/svg",innerHTML:le})}}),ue={id:"countdown-timer-container",class:"flex flex-center",style:{width:"70vw",height:"70vh"}},me=["innerHTML"],de={style:{height:"100%"}},ge=$({__name:"CountdownTimer",props:{duration:{},messageDuration:{default:.5},messageText:{default:"ðŸ˜ƒ"}},setup(p){let n;const e=Q(0),t=Q(0),o=p,s=S(()=>e.value>0),r=S(()=>e.value>0),_=S(()=>e.value<=o.messageDuration);j(()=>{h()}),W(()=>{C()});const C=()=>{clearInterval(n),e.value=0},h=()=>{t.value=o.duration,e.value=t.value,console.log(`starting timer, duration=${t.value}`),n=window.setInterval(()=>{e.value-=.05,e.value<=0&&clearInterval(n)},50)};return(u,v)=>T((a(),g("div",ue,[T(c("div",{id:"countdown-timer-message",style:{position:"absolute","font-size":"150px"},innerHTML:u.messageText},null,8,me),[[E,_.value]]),c("div",de,[T(f(ae,{"show-value":!_.value,style:{width:"100%",height:"100%"},value:e.value,min:0,max:t.value,reverse:"","animation-speed":"100","font-size":"0.5em",size:"70vh",color:"primary",class:"text-secondary"},{default:y(()=>[V(B(parseFloat(e.value.toFixed(0))),1)]),_:1},8,["show-value","value","max"]),[[E,r.value]])])],512)),[[E,s.value]])}}),fe={class:"row q-gutter-md action-buttons"},_e={style:{"white-space":"nowrap"},class:"gt-sm"},pe=$({__name:"FrontpageTriggerButtons",props:{triggers:{}},emits:["triggerAction"],setup(p,{emit:n}){const e=n;function t(o,s){e("triggerAction",o,s)}return(o,s)=>(a(),g("div",fe,[(a(!0),g(q,null,K(o.triggers,(r,_)=>(a(),g("div",{key:_},[r.show_button&&!(i(L.isEmpty)(r.title)&&i(L.isEmpty)(r.icon))?(a(),w(N,{key:0,stack:"",color:r.use_custom_color?"custom":"primary","no-caps":"",rounded:"",class:x(["action-button col-auto glass-effect",["action-button-"+_]]),style:U({"--bg-custom":r.use_custom_color?r.custom_color:null}),onClick:C=>t(r.action,r.config_index)},{default:y(()=>[i(L.isEmpty)(r.icon)?l("",!0):(a(),w(O,{key:0,name:`sym_o_${r.icon}`},null,8,["name"])),c("div",_e,B(r.title),1)]),_:2},1032,["color","class","style","onClick"])):l("",!0)]))),128))]))}}),ve={style:{position:"absolute"}},ye={id:"preview-container",class:""},he={id:"preview-outer-container",class:"preview-center-element"},be=["src"],we=$({__name:"PreviewStream",props:{enableMirrorEffectStream:{type:Boolean},enableMirrorEffectFrame:{type:Boolean},enableBlurredBackgroundStream:{type:Boolean},frameOverlayImage:{}},setup(p){const n=p;let e=null,t=null,o=null,s=null;const{status:r,open:_,close:C}=X("ws://localhost:8000/api/aquisition/stream",{immediate:!1,autoReconnect:{retries:-1,delay:1e3},onConnected(){console.log("stream connected via websockets")},onDisconnected(u,v){console.log("stream disconnected",v)},async onMessage(u,v){if(e&&t||o&&s){const b=await createImageBitmap(new Blob([v.data],{type:"image/jpeg"}));e&&t&&(e.width=b.width,e.height=b.height,t.drawImage(b,0,0)),o&&s&&(o.width=b.width,o.height=b.height,s.drawImage(b,0,0))}else console.error("jpeg bytes received but no canvas to draw to.")}}),h=S(()=>n.frameOverlayImage??!0);return j(()=>{const u=document.getElementById("preview-inner-overlay");u&&(u.onload=function(){console.error(u.naturalWidth/u.naturalHeight);const v=document.getElementById("preview-inner-container");v.style.aspectRatio=Number(u.naturalWidth/u.naturalHeight).toFixed(4)}),e=document.getElementById("preview-inner-stream"),o=document.getElementById("preview-outer-blurred"),e&&(t=e.getContext("2d")),o&&(s=o.getContext("2d")),(e||o)&&_()}),J(()=>{C()}),(u,v)=>(a(),g(q,null,[c("div",ve,B(i(r)),1),c("div",ye,[n.enableBlurredBackgroundStream?(a(),g("canvas",{key:0,id:"preview-outer-blurred",class:x(["preview-center-element",{mirroreffect:n.enableMirrorEffectStream}])},null,2)):l("",!0),c("div",he,[c("div",{id:"preview-inner-container",class:x(["preview-center-element",{"stream-no-preview":!h.value}])},[c("canvas",{id:"preview-inner-stream",class:x(["preview-center-element",{mirroreffect:n.enableMirrorEffectStream,cover:h.value,contain:!h.value}])},null,2),T(c("img",{id:"preview-inner-overlay",class:x(["preview-center-element contain",{mirroreffect:n.enableMirrorEffectFrame}]),src:n.frameOverlayImage},null,10,be),[[E,h.value]])],2)])])],64))}}),Se={key:1,class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},ke={key:2,id:"frontpage-countdown",class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},Ce=["innerHTML"],xe={key:0},Be={key:0},Me={class:"q-gutter-md"},Ie={class:"gt-sm"},Te={key:0},Ee={class:"q-gutter-md"},Ne={class:"gt-sm"},Fe=$({__name:"IndexPage",setup(p){const n=Y(),e=Z(),t=ee(),o=ie(),s=Q(0);te(s,()=>{s.value>=5&&o.push("/admin"),s.value=0},{debounce:500});const r=S(()=>{const m=[];return Object.entries(t.configuration.actions).forEach(([d,M])=>{M.forEach((k,A)=>{const P={action:`actions/${d}`,config_index:A,show_button:k.trigger.ui_trigger.show_button,title:k.trigger.ui_trigger.title,icon:k.trigger.ui_trigger.icon,use_custom_color:k.trigger.ui_trigger.use_custom_color,custom_color:k.trigger.ui_trigger.custom_color};m.push(P)})}),m}),_=S(()=>t.configuration.uisettings.admin_button_invisible),C=S(()=>{const m=t.configuration.uisettings.enable_livestream_when_idle,d=t.configuration.uisettings.enable_livestream_when_active,M=e.isStateIdle,k=e.isStateRecording,A=e.isStateCountdown,P=e.isStateCapture;return M&&m||(A||P)&&d||k}),h=S(()=>{if(e.isStateCountdown){const m=F.get(e.jobmodel.configuration_set,"processing.img_frame_enable",!1),d=F.get(e.jobmodel.configuration_set,"processing.img_frame_file","");return m?d:t.configuration.uisettings.livestream_frameoverlay_image}else return t.configuration.uisettings.enable_livestream_frameoverlay?t.configuration.uisettings.livestream_frameoverlay_image:""}),u=()=>{_.value?s.value++:o.push("/admin")},v=(m,d)=>{H(`/api/${m}/${d}`)},b=()=>{H("/api/processing/next")};return(m,d)=>(a(),w(ne,{id:"index-page",class:"q-pa-none full-height"},{default:y(()=>[C.value?(a(),w(we,{key:0,"frame-overlay-image":h.value,"enable-blurred-background-stream":i(t).configuration.uisettings.livestream_blurredbackground,"enable-mirror-effect-stream":i(t).configuration.uisettings.livestream_mirror_effect,"enable-mirror-effect-frame":i(t).configuration.uisettings.livestream_frameoverlay_mirror_effect},null,8,["frame-overlay-image","enable-blurred-background-stream","enable-mirror-effect-stream","enable-mirror-effect-frame"])):l("",!0),i(e).isStateProcessing?(a(),g("div",Se,[f(se,{size:"20em"})])):l("",!0),i(e).isStateCountdown?(a(),g("div",ke,[f(ge,{ref:"countdowntimer",duration:i(e).jobmodel.duration,"message-duration":i(t).configuration.uisettings.TAKEPIC_MSG_TIME,"message-text":i(t).configuration.uisettings.TAKEPIC_MSG_TEXT},null,8,["duration","message-duration","message-text"])])):l("",!0),i(e).isStateIdle?(a(),g("div",{key:3,id:"frontpage_text",innerHTML:i(t).configuration.uisettings.FRONTPAGE_TEXT},null,8,Ce)):l("",!0),f(I,{position:"bottom",class:"q-mb-lg"},{default:y(()=>[i(e).isStateIdle?(a(),g("div",xe,[f(pe,{triggers:r.value,onTriggerAction:v},null,8,["triggers"])])):l("",!0)]),_:1}),f(I,{position:"top-left",class:"q-ma-lg"},{default:y(()=>[i(e).isStateIdle?(a(),g("div",Be,[c("div",Me,[i(t).configuration.uisettings.show_gallery_on_frontpage?(a(),w(N,{key:0,id:"frontpage-button-to-gallery",color:"primary","no-caps":"",rounded:"",to:"/gallery",class:"action-button glass-effect"},{default:y(()=>[f(O,{left:"",name:"sym_o_photo_library"}),c("div",Ie,B(m.$t("BTN_LABEL_MAINPAGE_TO_GALLERY")),1)]),_:1})):l("",!0)])])):l("",!0)]),_:1}),f(I,{position:"top-right",class:"q-ma-lg"},{default:y(()=>[i(e).isStateIdle?(a(),g("div",Te,[c("div",Ee,[i(t).configuration.uisettings.show_admin_on_frontpage?(a(),w(N,{key:0,id:"frontpage-button-to-admin",rounded:"",color:"transparent","no-caps":"",class:x(["action-button action-button-admin glass-effect",{"action-button-admin-invisible":_.value}]),onClick:u},{default:y(()=>[f(O,{left:"",name:"sym_o_admin_panel_settings"}),c("div",Ne,B(m.$t("BTN_LABEL_MAINPAGE_TO_ADMIN")),1)]),_:1},8,["class"])):l("",!0)])])):l("",!0)]),_:1}),i(e).isStateRecording?(a(),w(I,{key:4,id:"frontpage-indicator-recording",position:"top",offset:[0,25],align:"center"},{default:y(()=>[f(ce,{color:"red",size:"10em"}),d[1]||(d[1]=c("br",null,null,-1)),f(N,{flat:"",color:"red",label:"Stop recording",onClick:d[0]||(d[0]=M=>b())})]),_:1})):l("",!0),i(t).configuration.uisettings.enable_automatic_slideshow&&i(n).collection_number_of_items>0?(a(),w(oe,{key:5,route:"/slideshow/random","timeout-ms":i(t).configuration.uisettings.show_automatic_slideshow_timeout*1e3,"warning-message":m.$t("MSG_WARN_BEFORE_AUTO_SLIDESHOW")},null,8,["timeout-ms","warning-message"])):l("",!0)]),_:1}))}});export{Fe as default};
