import{j as H,k as R,l as z,m as D,d as N,n as L,p as S,o as G,q as W,s as M,v as T,t as d,i as a,x as g,g as f,w as b,y as V,z as E,F as K,A as U,f as w,B as l,C as i,D as P,Q as I,E as X,G as C,H as Q,I as J,e as Y,J as Z,u as ee,a as te,K as ie,L as ne,c as ae,_ as O,r as F}from"./index-DvAVmX7Y.js";import{Q as B}from"./QPageSticky-BYN1iBfn.js";import{Q as oe}from"./QPage-Di3zMOIw.js";import{Q as re}from"./QCircularProgress-DAn1-rc6.js";import{_ as se}from"./RouteAfterTimeout.vue_vue_type_script_setup_true_lang-BhSPbYAR.js";import"./format-CJebrXOQ.js";const le='<circle cx="12.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="0s" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="52.5" r="12.5" fill-opacity=".5"><animate attributeName="fill-opacity" begin="100ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="300ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="600ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="800ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="400ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="700ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="500ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="200ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',ce=H({name:"QSpinnerGrid",props:R,setup(v){const{cSize:n,classes:e}=z(v);return()=>D("svg",{class:e.value,fill:"currentColor",width:n.value,height:n.value,viewBox:"0 0 105 105",xmlns:"http://www.w3.org/2000/svg",innerHTML:le})}}),ue='<g fill="none" fill-rule="evenodd" stroke-width="2"><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="0s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="0s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="-0.9s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="-0.9s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle></g>',me=H({name:"QSpinnerPuff",props:R,setup(v){const{cSize:n,classes:e}=z(v);return()=>D("svg",{class:e.value,stroke:"currentColor",width:n.value,height:n.value,viewBox:"0 0 44 44",xmlns:"http://www.w3.org/2000/svg",innerHTML:ue})}}),de={id:"countdown-timer-container",class:"flex flex-center",style:{width:"70vw",height:"70vh"}},ge=["innerHTML"],fe={style:{height:"100%"}},_e=N({__name:"CountdownTimer",props:{duration:{},messageDuration:{default:.5},messageText:{default:"ðŸ˜ƒ"}},setup(v){let n;const e=L(0),t=L(0),o=v,s=S(()=>e.value>0),r=S(()=>e.value>0),_=S(()=>e.value<=o.messageDuration);G(()=>{c()}),W(()=>{h()});const h=()=>{clearInterval(n),e.value=0},c=()=>{t.value=o.duration,e.value=t.value,console.log(`starting timer, duration=${t.value}`),n=window.setInterval(()=>{e.value-=.05,e.value<=0&&clearInterval(n)},50)};return(p,y)=>M((a(),d("div",de,[M(g("div",{id:"countdown-timer-message",style:{position:"absolute","font-size":"150px"},innerHTML:p.messageText},null,8,ge),[[T,_.value]]),g("div",fe,[M(f(re,{"show-value":!_.value,style:{width:"100%",height:"100%"},value:e.value,min:0,max:t.value,reverse:"","animation-speed":"100","font-size":"0.5em",size:"70vh",color:"primary",class:"text-secondary"},{default:b(()=>[V(E(parseFloat(e.value.toFixed(0))),1)]),_:1},8,["show-value","value","max"]),[[T,r.value]])])],512)),[[T,s.value]])}}),pe={class:"row q-gutter-md action-buttons"},ve={style:{"white-space":"nowrap"},class:"gt-sm"},he=N({__name:"FrontpageTriggerButtons",props:{triggers:{}},emits:["triggerAction"],setup(v,{emit:n}){const e=n;function t(o,s){e("triggerAction",o,s)}return(o,s)=>(a(),d("div",pe,[(a(!0),d(K,null,U(o.triggers,(r,_)=>(a(),d("div",{key:_},[r.show_button&&!(i(P.isEmpty)(r.title)&&i(P.isEmpty)(r.icon))?(a(),w(I,{key:0,stack:"",color:r.use_custom_color?"custom":"primary","no-caps":"",rounded:"",class:C(["action-button col-auto glass-effect",["action-button-"+_]]),style:X({"--bg-custom":r.use_custom_color?r.custom_color:null}),onClick:h=>t(r.action,r.config_index)},{default:b(()=>[i(P.isEmpty)(r.icon)?l("",!0):(a(),w(Q,{key:0,name:`sym_o_${r.icon}`},null,8,["name"])),g("div",ve,E(r.title),1)]),_:2},1032,["color","class","style","onClick"])):l("",!0)]))),128))]))}}),ye={id:"preview-container",class:""},be={id:"preview-outer-container",class:"preview-center-element"},we=["src"],Se=N({__name:"PreviewStream",props:{enableMirrorEffectStream:{type:Boolean},enableMirrorEffectFrame:{type:Boolean},enableBlurredBackgroundStream:{type:Boolean},frameOverlayImage:{}},setup(v){const n=v;let e=null,t=null,o=null,s=null;const{open:r,close:_}=J("ws://localhost:8000/api/aquisition/stream",{immediate:!1,autoReconnect:{retries:-1,delay:1e3},onConnected(){console.log("stream connected via websockets")},onDisconnected(c,p){console.log("stream disconnected",p)},async onMessage(c,p){if(e&&t||o&&s){const y=await createImageBitmap(new Blob([p.data],{type:"image/jpeg"}));e&&t&&(e.width=y.width,e.height=y.height,t.drawImage(y,0,0)),o&&s&&(o.width=y.width,o.height=y.height,s.drawImage(y,0,0))}else console.error("jpeg bytes received but no canvas to draw to.")}}),h=S(()=>n.frameOverlayImage??!0);return G(()=>{console.log("preview stream mounted!");const c=document.getElementById("preview-inner-overlay");c&&(c.onload=function(){console.log(c.naturalWidth/c.naturalHeight);const p=document.getElementById("preview-inner-container");p.style.aspectRatio=Number(c.naturalWidth/c.naturalHeight).toFixed(4)}),e=document.getElementById("preview-inner-stream"),o=document.getElementById("preview-outer-blurred"),e&&(t=e.getContext("2d")),o&&(s=o.getContext("2d")),(e||o)&&r()}),Y(()=>{_()}),(c,p)=>(a(),d("div",ye,[n.enableBlurredBackgroundStream?(a(),d("canvas",{key:0,id:"preview-outer-blurred",class:C(["preview-center-element",{mirroreffect:n.enableMirrorEffectStream}])},null,2)):l("",!0),g("div",be,[g("div",{id:"preview-inner-container",class:C(["preview-center-element",{"stream-no-preview":!h.value}])},[g("canvas",{id:"preview-inner-stream",class:C(["preview-center-element",{mirroreffect:n.enableMirrorEffectStream,cover:h.value,contain:!h.value}])},null,2),M(g("img",{id:"preview-inner-overlay",class:C(["preview-center-element contain",{mirroreffect:n.enableMirrorEffectFrame}]),src:n.frameOverlayImage},null,10,we),[[T,h.value]])],2)])]))}}),ke={key:1,class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},Ce={key:2,id:"frontpage-countdown",class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},xe=["innerHTML"],Be={key:0},Me={key:0},Te={class:"q-gutter-md"},Ie={class:"gt-sm"},Ee={key:0},Ne={class:"q-gutter-md"},$e={class:"gt-sm"},He=N({__name:"IndexPage",setup(v){const n=Z(),e=ee(),t=te(),o=ae(),s=L(0);ie(s,()=>{s.value>=5&&o.push("/admin"),s.value=0},{debounce:500});const r=S(()=>{const u=[];return Object.entries(t.configuration.actions).forEach(([m,x])=>{x.forEach((k,$)=>{const A={action:`actions/${m}`,config_index:$,show_button:k.trigger.ui_trigger.show_button,title:k.trigger.ui_trigger.title,icon:k.trigger.ui_trigger.icon,use_custom_color:k.trigger.ui_trigger.use_custom_color,custom_color:k.trigger.ui_trigger.custom_color};u.push(A)})}),u}),_=S(()=>t.configuration.uisettings.admin_button_invisible),h=S(()=>{const u=t.configuration.uisettings.enable_livestream_when_idle,m=t.configuration.uisettings.enable_livestream_when_active,x=e.isStateIdle,k=e.isStateRecording,$=e.isStateCountdown,A=e.isStateCapture;return x&&u||($||A)&&m||k}),c=ne(h,500),p=S(()=>{if(e.isStateCountdown){const u=O.get(e.jobmodel.configuration_set,"processing.img_frame_enable",!1),m=O.get(e.jobmodel.configuration_set,"processing.img_frame_file","");return u?m:t.configuration.uisettings.livestream_frameoverlay_image}else return t.configuration.uisettings.enable_livestream_frameoverlay?t.configuration.uisettings.livestream_frameoverlay_image:""}),y=()=>{_.value?s.value++:o.push("/admin")},j=(u,m)=>{F(`/api/${u}/${m}`)},q=()=>{F("/api/processing/next")};return(u,m)=>(a(),w(oe,{id:"index-page",class:"q-pa-none full-height"},{default:b(()=>[i(c)?(a(),w(Se,{key:0,"frame-overlay-image":p.value,"enable-blurred-background-stream":i(t).configuration.uisettings.livestream_blurredbackground,"enable-mirror-effect-stream":i(t).configuration.uisettings.livestream_mirror_effect,"enable-mirror-effect-frame":i(t).configuration.uisettings.livestream_frameoverlay_mirror_effect},null,8,["frame-overlay-image","enable-blurred-background-stream","enable-mirror-effect-stream","enable-mirror-effect-frame"])):l("",!0),i(e).isStateProcessing?(a(),d("div",ke,[f(ce,{size:"20em"})])):l("",!0),i(e).isStateCountdown?(a(),d("div",Ce,[f(_e,{ref:"countdowntimer",duration:i(e).jobmodel.duration,"message-duration":i(t).configuration.uisettings.TAKEPIC_MSG_TIME,"message-text":i(t).configuration.uisettings.TAKEPIC_MSG_TEXT},null,8,["duration","message-duration","message-text"])])):l("",!0),i(e).isStateIdle?(a(),d("div",{key:3,id:"frontpage_text",innerHTML:i(t).configuration.uisettings.FRONTPAGE_TEXT},null,8,xe)):l("",!0),f(B,{position:"bottom",class:"q-mb-lg"},{default:b(()=>[i(e).isStateIdle?(a(),d("div",Be,[f(he,{triggers:r.value,onTriggerAction:j},null,8,["triggers"])])):l("",!0)]),_:1}),f(B,{position:"top-left",class:"q-ma-lg"},{default:b(()=>[i(e).isStateIdle?(a(),d("div",Me,[g("div",Te,[i(t).configuration.uisettings.show_gallery_on_frontpage?(a(),w(I,{key:0,id:"frontpage-button-to-gallery",color:"primary","no-caps":"",rounded:"",to:"/gallery",class:"action-button glass-effect"},{default:b(()=>[f(Q,{left:"",name:"sym_o_photo_library"}),g("div",Ie,E(u.$t("BTN_LABEL_MAINPAGE_TO_GALLERY")),1)]),_:1})):l("",!0)])])):l("",!0)]),_:1}),f(B,{position:"top-right",class:"q-ma-lg"},{default:b(()=>[i(e).isStateIdle?(a(),d("div",Ee,[g("div",Ne,[i(t).configuration.uisettings.show_admin_on_frontpage?(a(),w(I,{key:0,id:"frontpage-button-to-admin",rounded:"",color:"transparent","no-caps":"",class:C(["action-button action-button-admin glass-effect",{"action-button-admin-invisible":_.value}]),onClick:y},{default:b(()=>[f(Q,{left:"",name:"sym_o_admin_panel_settings"}),g("div",$e,E(u.$t("BTN_LABEL_MAINPAGE_TO_ADMIN")),1)]),_:1},8,["class"])):l("",!0)])])):l("",!0)]),_:1}),i(e).isStateRecording?(a(),w(B,{key:4,id:"frontpage-indicator-recording",position:"top",offset:[0,25],align:"center"},{default:b(()=>[f(me,{color:"red",size:"10em"}),m[1]||(m[1]=g("br",null,null,-1)),f(I,{flat:"",color:"red",label:"Stop recording",onClick:m[0]||(m[0]=x=>q())})]),_:1})):l("",!0),i(t).configuration.uisettings.enable_automatic_slideshow&&i(n).collection_number_of_items>0?(a(),w(se,{key:5,route:"/slideshow/random","timeout-ms":i(t).configuration.uisettings.show_automatic_slideshow_timeout*1e3,"warning-message":u.$t("MSG_WARN_BEFORE_AUTO_SLIDESHOW")},null,8,["timeout-ms","warning-message"])):l("",!0)]),_:1}))}});export{He as default};
